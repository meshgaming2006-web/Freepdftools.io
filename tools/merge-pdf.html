<script>
    const fileInput = document.getElementById('fileInput');
    const fileList = document.getElementById('fileList');
    const mergeButton = document.getElementById('mergeButton');
    const dropZone = document.getElementById('dropZone');
    const resultDiv = document.getElementById('result');
    const downloadLink = document.getElementById('downloadLink');
    let files = [];

    fileInput.addEventListener('change', handleFileSelect);
    dropZone.addEventListener('dragover', (e) => { 
        e.preventDefault(); 
        dropZone.style.backgroundColor = '#f1f5f9'; 
    });
    dropZone.addEventListener('dragleave', (e) => { 
        e.preventDefault(); 
        dropZone.style.backgroundColor = 'white'; 
    });
    dropZone.addEventListener('drop', (e) => {
        e.preventDefault();
        dropZone.style.backgroundColor = 'white';
        handleFileSelect({ target: { files: e.dataTransfer.files } });
    });

    function handleFileSelect(event) {
        files = Array.from(event.target.files);
        if (files.length > 0) {
            mergeButton.disabled = false;
            mergeButton.style.opacity = '1';
            fileList.innerHTML = '<h3>Selected Files:</h3>' + 
                files.map(file => `<p>ðŸ“„ ${file.name}</p>`).join('');
        }
    }

    async function mergePdfs() {
        if (files.length < 2) {
            alert('Please select at least two PDF files to merge.');
            return;
        }

        mergeButton.disabled = true;
        mergeButton.textContent = 'Merging...';

        try {
            const { PDFDocument } = PDFLib;
            const mergedPdf = await PDFDocument.create();

            for (const file of files) {
                const arrayBuffer = await file.arrayBuffer();
                const pdf = await PDFDocument.load(arrayBuffer);
                const copiedPages = await mergedPdf.copyPages(pdf, pdf.getPageIndices());
                copiedPages.forEach((page) => mergedPdf.addPage(page));
            }

            const mergedPdfFile = await mergedPdf.save();
            const blob = new Blob([mergedPdfFile], { type: 'application/pdf' });
            const url = URL.createObjectURL(blob);

            downloadLink.href = url;
            downloadLink.download = "merged.pdf";
            resultDiv.style.display = 'block';

            mergeButton.textContent = 'Merge Successful!';
            mergeButton.style.backgroundColor = '#10b981';
        } catch (error) {
            console.error(error);
            alert('Error merging PDFs. Please try again.');
            mergeButton.disabled = false;
            mergeButton.textContent = 'Merge PDFs';
            mergeButton.style.opacity = '1';
        }
    }
</script>